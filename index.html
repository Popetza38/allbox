<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ระบบจัดการผู้ใช้งาน AOT</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- SheetJS -->
    <script src="https://cdn.sheetjs.com/xlsx-0.20.1/package/dist/xlsx.full.min.js"></script>
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>
    <!-- SweetAlert2 -->
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    
    <!-- Google Fonts: Niramit -->
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Niramit:wght@300;400;500;600;700&display=swap');
        
        body { 
            font-family: 'Niramit', sans-serif; 
            background-color: #f0f4f8;
            overflow-x: hidden;
        }

        /* Decorative Background Blobs */
        .blob {
            position: absolute;
            filter: blur(80px);
            z-index: -1;
            opacity: 0.6;
            animation: float 10s ease-in-out infinite;
        }
        .blob-1 { top: -10%; left: -10%; width: 500px; height: 500px; background: #c084fc; animation-delay: 0s; }
        .blob-2 { top: 20%; right: -10%; width: 400px; height: 400px; background: #60a5fa; animation-delay: 2s; }
        .blob-3 { bottom: -10%; left: 20%; width: 600px; height: 600px; background: #34d399; animation-delay: 4s; opacity: 0.4; }

        @keyframes float {
            0%, 100% { transform: translate(0, 0) scale(1); }
            50% { transform: translate(20px, -20px) scale(1.05); }
        }

        /* Custom Scrollbar */
        .custom-scrollbar::-webkit-scrollbar { width: 6px; height: 6px; }
        .custom-scrollbar::-webkit-scrollbar-track { background: transparent; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: rgba(148, 163, 184, 0.5); border-radius: 10px; }
        .custom-scrollbar::-webkit-scrollbar-thumb:hover { background: rgba(100, 116, 139, 0.8); }
        
        /* SweetAlert Customization */
        .swal2-popup {
            font-family: 'Niramit', sans-serif !important;
            border-radius: 20px !important;
            padding: 2rem !important;
            backdrop-filter: blur(10px);
            background: rgba(255, 255, 255, 0.95) !important;
        }

        /* Ultra Modern Glass Card */
        .glass-panel {
            background: rgba(255, 255, 255, 0.7);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.8);
            box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.07);
        }

        /* Input Focus & Hover Transitions */
        .input-group { transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1); }
        .input-group:hover { transform: translateY(-2px); box-shadow: 0 4px 12px rgba(0,0,0,0.05); }
        .input-group:focus-within { transform: translateY(-2px); box-shadow: 0 4px 20px rgba(59, 130, 246, 0.15); border-color: #60a5fa; }

        /* Button Gradient Animation */
        .btn-gradient {
            background-size: 200% auto;
            transition: 0.5s;
        }
        .btn-gradient:hover {
            background-position: right center;
        }

        /* Table Styling */
        .modern-table thead th {
            background: rgba(248, 250, 252, 0.9);
            backdrop-filter: blur(4px);
            color: #475569;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            font-size: 0.75rem;
        }
        .modern-table tbody tr { transition: background-color 0.2s; }
        .modern-table tbody tr:hover { background-color: rgba(241, 245, 249, 0.8); }
    </style>
</head>
<body class="min-h-screen p-4 md:p-8 text-slate-800 relative">

    <!-- Background Blobs -->
    <div class="blob blob-1 rounded-full mix-blend-multiply filter blur-3xl opacity-30 animate-blob"></div>
    <div class="blob blob-2 rounded-full mix-blend-multiply filter blur-3xl opacity-30 animate-blob"></div>
    <div class="blob blob-3 rounded-full mix-blend-multiply filter blur-3xl opacity-30 animate-blob"></div>

    <div id="app" class="max-w-7xl mx-auto relative z-10 space-y-8">
        
        <!-- Header Section -->
        <header class="flex flex-col items-center justify-center space-y-2 py-4">
            <div class="inline-flex items-center gap-3 px-6 py-3 bg-white/40 backdrop-blur-md rounded-2xl border border-white/50 shadow-sm">
                <div class="bg-gradient-to-tr from-blue-600 to-indigo-600 p-2.5 rounded-xl shadow-lg shadow-blue-200">
                    <i data-lucide="plane" class="text-white w-6 h-6"></i>
                </div>
                <div class="text-left">
                    <h1 class="text-2xl font-bold bg-clip-text text-transparent bg-gradient-to-r from-slate-800 to-slate-600 tracking-tight">AOT User Management</h1>
                    <p class="text-xs text-slate-500 font-medium tracking-wide">Professional Data Import Tool</p>
                </div>
            </div>
        </header>

        <!-- Main Container -->
        <div class="glass-panel rounded-[2rem] overflow-hidden">
            
            <!-- Tab Navigation -->
            <div class="border-b border-slate-200/50 p-2 bg-white/40 sticky top-0 z-20 backdrop-blur-xl">
                <div class="flex p-1.5 bg-slate-100/50 rounded-2xl relative max-w-lg mx-auto shadow-inner">
                    <button onclick="switchTab('import')" id="tab-import" class="tab-btn flex-1 flex items-center justify-center gap-2 py-3 text-sm font-bold rounded-xl shadow-sm bg-white text-blue-600 ring-1 ring-black/5 transition-all">
                        <i data-lucide="file-plus" size="18"></i> สร้างไฟล์ Import
                    </button>
                    <button onclick="switchTab('compare')" id="tab-compare" class="tab-btn flex-1 flex items-center justify-center gap-2 py-3 text-sm font-medium rounded-xl text-slate-500 hover:text-slate-700 hover:bg-white/40 transition-all">
                        <i data-lucide="git-compare" size="18"></i> เปรียบเทียบข้อมูล
                    </button>
                </div>
            </div>

            <div class="p-6 md:p-10">
                <!-- ========================================== -->
                <!-- MODE 1: IMPORT GENERATOR                   -->
                <!-- ========================================== -->
                <div id="importSection" class="space-y-8">
                    
                    <!-- Settings Dashboard (Beautiful Dropdowns) -->
                    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-5">
                        <!-- Dropdown 1: Description -->
                        <div class="relative group transition-all duration-300 transform hover:-translate-y-1">
                            <div class="absolute -inset-0.5 bg-gradient-to-r from-blue-300 to-blue-400 rounded-2xl blur opacity-20 group-hover:opacity-60 transition duration-500"></div>
                            <div class="relative bg-white p-4 rounded-xl border border-slate-100 shadow-sm h-full flex flex-col justify-between">
                                <div class="flex items-center gap-2 mb-2">
                                    <div class="p-1.5 bg-blue-50 text-blue-600 rounded-lg shadow-sm">
                                        <i data-lucide="file-text" size="16"></i>
                                    </div>
                                    <label class="text-[10px] font-bold text-slate-400 uppercase tracking-wider">Description</label>
                                </div>
                                <div class="relative">
                                    <select id="descConfig" class="block w-full py-2.5 pl-3 pr-8 text-sm font-bold text-slate-700 bg-slate-50 border border-slate-200 rounded-lg appearance-none cursor-pointer focus:outline-none focus:ring-2 focus:ring-blue-500/20 focus:border-blue-500 transition-all hover:bg-white"></select>
                                    <div class="absolute inset-y-0 right-0 flex items-center px-2 pointer-events-none text-slate-400 group-hover:text-blue-500 transition-colors">
                                        <i data-lucide="chevron-down" size="16"></i>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Dropdown 2: Company -->
                        <div class="relative group transition-all duration-300 transform hover:-translate-y-1">
                            <div class="absolute -inset-0.5 bg-gradient-to-r from-indigo-300 to-indigo-400 rounded-2xl blur opacity-20 group-hover:opacity-60 transition duration-500"></div>
                            <div class="relative bg-white p-4 rounded-xl border border-slate-100 shadow-sm h-full flex flex-col justify-between">
                                <div class="flex items-center gap-2 mb-2">
                                    <div class="p-1.5 bg-indigo-50 text-indigo-600 rounded-lg shadow-sm">
                                        <i data-lucide="building-2" size="16"></i>
                                    </div>
                                    <label class="text-[10px] font-bold text-slate-400 uppercase tracking-wider">Company</label>
                                </div>
                                <div class="relative">
                                    <select id="compConfig" class="block w-full py-2.5 pl-3 pr-8 text-sm font-bold text-slate-700 bg-slate-50 border border-slate-200 rounded-lg appearance-none cursor-pointer focus:outline-none focus:ring-2 focus:ring-indigo-500/20 focus:border-indigo-500 transition-all hover:bg-white"></select>
                                    <div class="absolute inset-y-0 right-0 flex items-center px-2 pointer-events-none text-slate-400 group-hover:text-indigo-500 transition-colors">
                                        <i data-lucide="chevron-down" size="16"></i>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Dropdown 3: Group -->
                        <div class="relative group transition-all duration-300 transform hover:-translate-y-1">
                            <div class="absolute -inset-0.5 bg-gradient-to-r from-emerald-300 to-emerald-400 rounded-2xl blur opacity-20 group-hover:opacity-60 transition duration-500"></div>
                            <div class="relative bg-white p-4 rounded-xl border border-slate-100 shadow-sm h-full flex flex-col justify-between">
                                <div class="flex items-center gap-2 mb-2">
                                    <div class="p-1.5 bg-emerald-50 text-emerald-600 rounded-lg shadow-sm">
                                        <i data-lucide="users" size="16"></i>
                                    </div>
                                    <label class="text-[10px] font-bold text-slate-400 uppercase tracking-wider">Group</label>
                                </div>
                                <div class="relative">
                                    <select id="groupConfig" class="block w-full py-2.5 pl-3 pr-8 text-sm font-bold text-slate-700 bg-slate-50 border border-slate-200 rounded-lg appearance-none cursor-pointer focus:outline-none focus:ring-2 focus:ring-emerald-500/20 focus:border-emerald-500 transition-all hover:bg-white"></select>
                                    <div class="absolute inset-y-0 right-0 flex items-center px-2 pointer-events-none text-slate-400 group-hover:text-emerald-500 transition-colors">
                                        <i data-lucide="chevron-down" size="16"></i>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Input 4: Password Suffix -->
                        <div class="relative group transition-all duration-300 transform hover:-translate-y-1">
                            <div class="absolute -inset-0.5 bg-gradient-to-r from-rose-300 to-pink-400 rounded-2xl blur opacity-20 group-hover:opacity-60 transition duration-500"></div>
                            <div class="relative bg-white p-4 rounded-xl border border-slate-100 shadow-sm h-full flex flex-col justify-between">
                                <div class="flex items-center gap-2 mb-2">
                                    <div class="p-1.5 bg-rose-50 text-rose-500 rounded-lg shadow-sm">
                                        <i data-lucide="key" size="16"></i>
                                    </div>
                                    <label class="text-[10px] font-bold text-slate-400 uppercase tracking-wider">Password Suffix</label>
                                </div>
                                <div class="flex items-center bg-slate-50 border border-slate-200 rounded-lg px-3 py-2 focus-within:ring-2 focus-within:ring-rose-500/20 focus-within:border-rose-500 focus-within:bg-white transition-all">
                                    <span class="text-[10px] text-slate-400 mr-2 bg-white px-1.5 py-0.5 rounded shadow-sm border border-slate-100">ต่อท้าย</span>
                                    <input type="text" id="pwdSuffixConfig" value="0" class="w-full bg-transparent font-bold text-rose-600 outline-none text-sm placeholder:text-slate-300" placeholder="0">
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="grid grid-cols-1 xl:grid-cols-12 gap-8">
                        <!-- Left Panel: Input -->
                        <div class="xl:col-span-4 flex flex-col gap-5">
                            <div class="bg-white rounded-3xl border border-white/50 shadow-lg shadow-slate-200/50 flex flex-col h-full overflow-hidden relative group">
                                <div class="absolute top-0 left-0 w-full h-1 bg-gradient-to-r from-blue-400 to-indigo-500"></div>
                                <div class="bg-slate-50/50 p-5 border-b border-slate-100 flex justify-between items-center backdrop-blur-sm">
                                    <div class="flex items-center gap-3 text-slate-700 font-bold text-sm">
                                        <div class="w-8 h-8 rounded-xl bg-white shadow-sm flex items-center justify-center text-blue-600 ring-1 ring-slate-100">
                                            <i data-lucide="terminal" size="16"></i>
                                        </div>
                                        ข้อมูลนำเข้า
                                    </div>
                                    <div class="flex gap-2">
                                        <label class="cursor-pointer p-2 hover:bg-blue-50 text-slate-400 hover:text-blue-600 rounded-xl transition-all" title="นำเข้าไฟล์">
                                            <i data-lucide="upload-cloud" size="20"></i>
                                            <input type="file" id="fileInput" accept=".csv,.xlsx,.xls,.txt" class="hidden">
                                        </label>
                                        <button onclick="confirmClearAll()" class="p-2 hover:bg-red-50 text-slate-400 hover:text-red-500 rounded-xl transition-all" title="ล้างข้อมูล">
                                            <i data-lucide="trash-2" size="20"></i>
                                        </button>
                                    </div>
                                </div>
                                <div class="relative flex-grow bg-white">
                                    <textarea id="inputText" class="w-full h-80 xl:h-full p-6 text-xs font-mono bg-transparent outline-none resize-none custom-scrollbar text-slate-600 leading-relaxed placeholder:text-slate-300" placeholder="วางข้อมูลที่นี่...&#10;&#10;ตัวอย่าง:&#10;user01, Somchai Jai-dee&#10;user02, Mana Meemark"></textarea>
                                </div>
                            </div>
                            
                            <button onclick="handleProcess()" id="processBtn" class="w-full py-4 bg-gradient-to-r from-blue-600 via-indigo-600 to-blue-700 btn-gradient text-white rounded-2xl font-bold shadow-xl shadow-blue-200 hover:shadow-blue-300 flex items-center justify-center gap-3 transform active:scale-[0.98] transition-all group">
                                <i data-lucide="sparkles" size="20" class="group-hover:animate-pulse"></i> 
                                ประมวลผลข้อมูล
                            </button>
                        </div>

                        <!-- Right Panel: Output -->
                        <div class="xl:col-span-8">
                            <div class="bg-white rounded-3xl border border-white/50 shadow-lg shadow-slate-200/50 flex flex-col h-[650px] overflow-hidden relative">
                                <div class="absolute top-0 left-0 w-full h-1 bg-gradient-to-r from-emerald-400 to-teal-500"></div>
                                <div class="p-5 border-b border-slate-100 flex items-center justify-between bg-slate-50/30">
                                    <div class="flex items-center gap-3">
                                        <div class="w-8 h-8 rounded-xl bg-emerald-100/50 flex items-center justify-center text-emerald-600">
                                            <i data-lucide="table-2" size="18"></i>
                                        </div>
                                        <div>
                                            <h2 class="text-sm font-bold text-slate-700">ตัวอย่างผลลัพธ์</h2>
                                            <p class="text-[10px] text-slate-400 font-medium">Ready for export</p>
                                        </div>
                                    </div>
                                    <button id="downloadBtn" onclick="downloadExcel()" class="hidden bg-emerald-500 hover:bg-emerald-600 text-white px-5 py-2.5 rounded-xl text-xs font-bold transition-all flex items-center gap-2 shadow-lg shadow-emerald-200">
                                        <i data-lucide="sheet" size="16"></i> ส่งออก Excel
                                    </button>
                                </div>

                                <div id="tableContainer" class="hidden overflow-auto flex-grow custom-scrollbar bg-white p-1">
                                    <table class="w-full text-left text-[11px] border-collapse min-w-[1000px] modern-table">
                                        <thead class="sticky top-0 z-10 shadow-sm">
                                            <tr>
                                                <th class="p-4 border-b border-slate-200 rounded-l-lg">Login</th>
                                                <th class="p-4 border-b border-slate-200">First Name</th>
                                                <th class="p-4 border-b border-slate-200">Last Name</th>
                                                <th class="p-4 border-b border-slate-200">Description</th>
                                                <th class="p-4 border-b border-slate-200">Password</th>
                                                <th class="p-4 border-b border-slate-200">Repeat Pwd</th>
                                                <th class="p-4 border-b border-slate-200">Company</th>
                                                <th class="p-4 border-b border-slate-200 rounded-r-lg">Group</th>
                                            </tr>
                                        </thead>
                                        <tbody id="resultBody" class="divide-y divide-slate-50 text-slate-600"></tbody>
                                    </table>
                                </div>

                                <div id="emptyState" class="flex-grow flex flex-col items-center justify-center text-slate-400 bg-white p-6 text-center">
                                    <div class="relative mb-6">
                                        <div class="absolute inset-0 bg-blue-100 rounded-full blur-xl opacity-50 animate-pulse"></div>
                                        <div class="w-24 h-24 bg-gradient-to-br from-slate-50 to-slate-100 rounded-3xl flex items-center justify-center shadow-inner border border-white relative z-10">
                                            <i data-lucide="layout-list" size="40" class="text-slate-300"></i>
                                        </div>
                                    </div>
                                    <p class="font-bold text-slate-700 text-base">ยังไม่มีข้อมูล</p>
                                    <p class="text-xs text-slate-400 mt-2 max-w-xs leading-relaxed">นำเข้าไฟล์หรือวางข้อมูลทางด้านซ้ายเพื่อเริ่มต้น<br>ระบบจะแยกชื่อและสร้างรหัสผ่านให้อัตโนมัติ</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- ========================================== -->
                <!-- MODE 2: COMPARISON                         -->
                <!-- ========================================== -->
                <div id="compareSection" class="hidden space-y-8">
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                        <!-- Input A -->
                        <div class="bg-white p-1 rounded-3xl border border-slate-100 shadow-lg shadow-slate-200/50 transition-all hover:-translate-y-1 hover:shadow-xl">
                            <div class="p-4 border-b border-slate-50 flex justify-between items-center bg-slate-50/50 rounded-t-[1.3rem]">
                                <div class="flex items-center gap-3">
                                    <span class="bg-white text-slate-700 px-3 py-1.5 rounded-xl shadow-sm border border-slate-100 text-xs font-bold tracking-tight ring-1 ring-slate-100">SET A</span>
                                    <span class="text-xs font-bold text-slate-500">ข้อมูลต้นฉบับ</span>
                                </div>
                                <label class="cursor-pointer text-blue-600 hover:text-blue-700 text-xs font-bold flex items-center gap-2 bg-blue-50 px-4 py-2 rounded-xl hover:bg-blue-100 transition-colors">
                                    <i data-lucide="upload" size="14"></i> โหลดไฟล์
                                    <input type="file" onchange="loadFileToTextarea(this, 'inputA')" accept=".csv,.xlsx,.xls,.txt" class="hidden">
                                </label>
                            </div>
                            <textarea id="inputA" class="w-full h-56 p-6 text-xs font-mono bg-white outline-none resize-none rounded-b-[1.3rem] text-slate-600 placeholder:text-slate-300" placeholder="วางข้อมูลชุด A ที่นี่..."></textarea>
                        </div>

                        <!-- Input B -->
                        <div class="bg-white p-1 rounded-3xl border border-slate-100 shadow-lg shadow-slate-200/50 transition-all hover:-translate-y-1 hover:shadow-xl">
                            <div class="p-4 border-b border-slate-50 flex justify-between items-center bg-slate-50/50 rounded-t-[1.3rem]">
                                <div class="flex items-center gap-3">
                                    <span class="bg-gradient-to-r from-blue-600 to-indigo-600 text-white px-3 py-1.5 rounded-xl shadow-md shadow-blue-200 text-xs font-bold tracking-tight">SET B</span>
                                    <span class="text-xs font-bold text-slate-500">ข้อมูลชุดใหม่</span>
                                </div>
                                <label class="cursor-pointer text-blue-600 hover:text-blue-700 text-xs font-bold flex items-center gap-2 bg-blue-50 px-4 py-2 rounded-xl hover:bg-blue-100 transition-colors">
                                    <i data-lucide="upload" size="14"></i> โหลดไฟล์
                                    <input type="file" onchange="loadFileToTextarea(this, 'inputB')" accept=".csv,.xlsx,.xls,.txt" class="hidden">
                                </label>
                            </div>
                            <textarea id="inputB" class="w-full h-56 p-6 text-xs font-mono bg-white outline-none resize-none rounded-b-[1.3rem] text-slate-600 placeholder:text-slate-300" placeholder="วางข้อมูลชุด B ที่นี่..."></textarea>
                        </div>
                    </div>

                    <!-- Action -->
                    <div class="flex justify-center py-4">
                        <div class="relative group cursor-pointer" onclick="handleCompare()">
                            <div class="absolute -inset-1 bg-gradient-to-r from-blue-600 via-purple-500 to-indigo-600 rounded-full blur opacity-30 group-hover:opacity-60 transition-opacity duration-500"></div>
                            <button class="relative px-12 py-4 bg-white text-slate-700 border border-slate-100 hover:border-blue-200 rounded-full font-bold shadow-xl flex items-center gap-3 z-10 transform active:scale-95 transition-all group-hover:text-blue-600">
                                <div class="bg-slate-50 p-2 rounded-full group-hover:bg-blue-50 transition-colors">
                                    <i data-lucide="arrow-left-right" size="18"></i> 
                                </div>
                                <span class="text-sm">เริ่มเปรียบเทียบข้อมูล</span>
                            </button>
                        </div>
                    </div>

                    <!-- Results -->
                    <div id="compareResults" class="hidden grid grid-cols-1 lg:grid-cols-2 gap-6">
                        <!-- Missing Card -->
                        <div class="bg-white rounded-3xl border border-red-100 shadow-xl shadow-red-50/50 overflow-hidden flex flex-col h-[500px]">
                            <div class="bg-red-50/30 p-5 border-b border-red-50 flex justify-between items-center backdrop-blur-sm">
                                <div class="flex items-center gap-3">
                                    <div class="p-3 bg-red-100 text-red-500 rounded-2xl shadow-sm">
                                        <i data-lucide="user-x" size="20"></i>
                                    </div>
                                    <div>
                                        <h3 class="font-bold text-slate-700 text-sm">หายไปในชุด B (Missing)</h3>
                                        <p class="text-[10px] text-red-400 font-medium mt-0.5">มีใน A แต่ไม่มีใน B</p>
                                    </div>
                                </div>
                                <span id="countMissing" class="bg-white text-red-500 px-4 py-1.5 rounded-xl text-xs font-bold border border-red-100 shadow-sm min-w-[3rem] text-center ring-2 ring-red-50">0</span>
                            </div>
                            <div class="overflow-auto custom-scrollbar flex-grow p-0 bg-white">
                                <table class="w-full text-xs text-left modern-table">
                                    <thead class="bg-white/80 backdrop-blur text-slate-400 sticky top-0 border-b border-slate-100 z-10">
                                        <tr>
                                            <th class="p-4 w-1/3">Login</th>
                                            <th class="p-4 w-2/3">Full Name</th>
                                        </tr>
                                    </thead>
                                    <tbody id="tbodyMissing" class="divide-y divide-red-50 bg-red-50/5 text-slate-600"></tbody>
                                </table>
                            </div>
                        </div>

                        <!-- New Card -->
                        <div class="bg-white rounded-3xl border border-emerald-100 shadow-xl shadow-emerald-50/50 overflow-hidden flex flex-col h-[500px]">
                            <div class="bg-emerald-50/30 p-5 border-b border-emerald-50 flex justify-between items-center backdrop-blur-sm">
                                <div class="flex items-center gap-3">
                                    <div class="p-3 bg-emerald-100 text-emerald-600 rounded-2xl shadow-sm">
                                        <i data-lucide="user-plus" size="20"></i>
                                    </div>
                                    <div>
                                        <h3 class="font-bold text-slate-700 text-sm">เพิ่มมาใหม่ในชุด B (New)</h3>
                                        <p class="text-[10px] text-emerald-500 font-medium mt-0.5">ไม่มีใน A แต่มีใน B</p>
                                    </div>
                                </div>
                                <span id="countNew" class="bg-white text-emerald-600 px-4 py-1.5 rounded-xl text-xs font-bold border border-emerald-100 shadow-sm min-w-[3rem] text-center ring-2 ring-emerald-50">0</span>
                            </div>
                            <div class="overflow-auto custom-scrollbar flex-grow p-0 bg-white">
                                <table class="w-full text-xs text-left modern-table">
                                    <thead class="bg-white/80 backdrop-blur text-slate-400 sticky top-0 border-b border-slate-100 z-10">
                                        <tr>
                                            <th class="p-4 w-1/3">Login</th>
                                            <th class="p-4 w-2/3">Full Name</th>
                                        </tr>
                                    </thead>
                                    <tbody id="tbodyNew" class="divide-y divide-emerald-50 bg-emerald-50/5 text-slate-600"></tbody>
                                    </table>
                            </div>
                        </div>
                    </div>
                    
                    <div id="exportCompareBtn" class="hidden text-center pt-8 pb-4">
                        <button onclick="exportComparison()" class="bg-slate-800 hover:bg-slate-900 text-white px-10 py-4 rounded-2xl font-bold shadow-2xl shadow-slate-300 inline-flex items-center gap-3 transform active:scale-95 transition-all group">
                            <div class="bg-slate-700 p-1.5 rounded-lg group-hover:bg-slate-600 transition-colors">
                                <i data-lucide="download" size="18"></i> 
                            </div>
                            <span class="tracking-wide">ดาวน์โหลดรายงานเปรียบเทียบ</span>
                        </button>
                    </div>
                </div>
            </div>
        </div>
        
        <footer class="text-center text-slate-400 text-xs py-8 font-medium opacity-60 hover:opacity-100 transition-opacity">
            &copy; 2024 AOT User Management Tool • Designed with <span class="text-rose-400 animate-pulse">❤</span> for AOT
        </footer>
    </div>

    <!-- Logic Script (Same logic, maintained) -->
    <script>
        // Constants
        const DESCRIPTION_OPTIONS = ["AOT Screening Operator", "AOT AVSEC", "AOT Inspectors Operator", "AOT Inspectors Service", "AOT Supervisor", "AOT Technician", "T.T.S Service"];
        const COMPANY_OPTIONS = ["AOT BKK", "T.T.S.", "AOT AVSEC", "Smiths Heimann"];
        const titlesList = ['MASTER', 'SGT', 'LT', 'MAJOR', 'COL', 'CAPT', 'REV', 'MDM', 'MADAM', 'SIR', 'PROF', 'DR', 'MISS', 'MRS', 'MS', 'MR'];

        let processedResults = [];
        let compareData = { missing: [], newItems: [] };

        function init() {
            const populate = (id, opts) => {
                const sel = document.getElementById(id);
                opts.forEach(o => { const el = document.createElement('option'); el.value = el.textContent = o; sel.appendChild(el); });
            };
            populate('descConfig', DESCRIPTION_OPTIONS);
            populate('compConfig', COMPANY_OPTIONS);
            populate('groupConfig', DESCRIPTION_OPTIONS);
            lucide.createIcons();
        }

        // ========================
        // TAB LOGIC
        // ========================
        function switchTab(mode) {
            const importSec = document.getElementById('importSection');
            const compareSec = document.getElementById('compareSection');
            const tabImport = document.getElementById('tab-import');
            const tabCompare = document.getElementById('tab-compare');

            if (mode === 'import') {
                importSec.classList.remove('hidden');
                compareSec.classList.add('hidden');
                
                // Style Active
                tabImport.classList.remove('bg-transparent', 'text-slate-500', 'hover:bg-white/40');
                tabImport.classList.add('bg-white', 'text-blue-600', 'shadow-sm', 'ring-1', 'ring-black/5');
                
                // Style Inactive
                tabCompare.classList.add('bg-transparent', 'text-slate-500', 'hover:bg-white/40');
                tabCompare.classList.remove('bg-white', 'text-blue-600', 'shadow-sm', 'ring-1', 'ring-black/5');

            } else {
                importSec.classList.add('hidden');
                compareSec.classList.remove('hidden');
                
                // Style Active
                tabCompare.classList.remove('bg-transparent', 'text-slate-500', 'hover:bg-white/40');
                tabCompare.classList.add('bg-white', 'text-blue-600', 'shadow-sm', 'ring-1', 'ring-black/5');
                
                // Style Inactive
                tabImport.classList.add('bg-transparent', 'text-slate-500', 'hover:bg-white/40');
                tabImport.classList.remove('bg-white', 'text-blue-600', 'shadow-sm', 'ring-1', 'ring-black/5');
            }
        }

        // ========================
        // LOGIC FOR IMPORT GENERATOR
        // ========================
        function splitName(fullName) {
            if (!fullName) return { firstName: '', lastName: '' };
            let cleanName = fullName.trim();
            let title = "";
            let lastName = "";
            const titleRegex = new RegExp(`^(${titlesList.join('|')})(\\.?\\s*|\\s+|$)`, 'i');
            const match = cleanName.match(titleRegex);
            let remainingPart = cleanName;
            if (match) {
                title = match[1].toUpperCase();
                if (title !== 'MISS' && !title.endsWith('.')) title += '.';
                remainingPart = cleanName.substring(match[0].length).trim();
            }
            const parts = remainingPart.split(/\s+/).filter(p => p.length > 0);
            let firstName = parts[0] || "";
            if (parts.length >= 2) lastName = parts.slice(1).join(' ');
            return {
                firstName: title ? `${title} ${firstName.toUpperCase()}`.trim() : firstName.toUpperCase(),
                lastName: lastName.toUpperCase()
            };
        }

        async function handleProcess() {
            const text = document.getElementById('inputText').value;
            if (!text.trim()) { Swal.fire({ icon: 'warning', title: 'ไม่พบข้อมูล' }); return; }
            Swal.fire({ title: 'กำลังประมวลผล...', didOpen: () => Swal.showLoading() });
            
            setTimeout(() => {
                const config = {
                    description: document.getElementById('descConfig').value,
                    company: document.getElementById('compConfig').value,
                    groupName: document.getElementById('groupConfig').value
                };
                const pwdSuffix = document.getElementById('pwdSuffixConfig').value || "";

                try {
                    const lines = text.split('\n').filter(line => line.trim() !== '');
                    processedResults = lines.map(line => {
                        let loginName = "";
                        let firstName = "";
                        let lastName = "";
                        const delimiter = line.includes('\t') ? '\t' : ',';
                        if (line.includes(delimiter)) {
                            const cols = line.split(delimiter);
                            const cleanCols = cols.map(c => c.trim().replace(/^"|"$/g, ''));
                            loginName = cleanCols[0];
                            const rawFirst = cleanCols[1] || '';
                            const rawLast = cleanCols[2] || '';
                            if (rawLast) {
                                let fNamePart = rawFirst;
                                let title = "";
                                const titleRegex = new RegExp(`^(${titlesList.join('|')})(\\.?\\s*|\\s+|$)`, 'i');
                                const match = fNamePart.match(titleRegex);
                                if (match) {
                                    title = match[1].toUpperCase();
                                    if (title !== 'MISS' && !title.endsWith('.')) title += '.';
                                    fNamePart = fNamePart.substring(match[0].length).trim();
                                }
                                firstName = title ? `${title} ${fNamePart.toUpperCase()}` : fNamePart.toUpperCase();
                                lastName = rawLast.toUpperCase();
                            } else {
                                const splitData = splitName(rawFirst);
                                firstName = splitData.firstName;
                                lastName = splitData.lastName;
                            }
                            if (/name|รหัส|login/i.test(loginName)) return null;
                        } else {
                             const fullName = line.trim().replace(/^"|"$/g, '');
                             if (!fullName) return null;
                             const splitData = splitName(fullName);
                             firstName = splitData.firstName;
                             lastName = splitData.lastName;
                        }
                        if (!firstName && !loginName) return null;
                        const pwd = loginName ? `${loginName}${pwdSuffix}` : "";
                        return { loginName, firstName, lastName, ...config, password: pwd };
                    }).filter(Boolean);

                    if (processedResults.length === 0) throw new Error("Format Error");
                    renderTable();
                    Swal.fire({ icon: 'success', title: 'สำเร็จ', timer: 1000, showConfirmButton: false });
                } catch (err) {
                    Swal.fire({ icon: 'error', title: 'เกิดข้อผิดพลาด', text: err.message });
                }
            }, 500);
        }

        function renderTable() {
            const body = document.getElementById('resultBody');
            body.innerHTML = '';
            processedResults.forEach(res => {
                body.insertAdjacentHTML('beforeend', `
                    <tr class="transition-colors border-b border-slate-50 last:border-0">
                        <td class="p-4 font-mono text-slate-600 border-r border-slate-100">${res.loginName}</td>
                        <td class="p-4 text-blue-700 font-bold border-r border-slate-100">${res.firstName}</td>
                        <td class="p-4 text-slate-500 border-r border-slate-100">${res.lastName}</td>
                        <td class="p-4 text-slate-700 border-r border-slate-100">${res.description}</td>
                        <td class="p-4 text-orange-600 font-mono text-[10px] border-r border-slate-100">${res.password}</td>
                        <td class="p-4 text-orange-600 font-mono text-[10px] border-r border-slate-100">${res.password}</td>
                        <td class="p-4 text-slate-700 border-r border-slate-100">${res.company}</td>
                        <td class="p-4 text-slate-700">${res.groupName}</td>
                    </tr>`);
            });
            document.getElementById('emptyState').classList.add('hidden');
            document.getElementById('tableContainer').classList.remove('hidden');
            document.getElementById('downloadBtn').classList.remove('hidden');
        }

        // ========================
        // LOGIC FOR COMPARE
        // ========================
        function parseForCompare(text) {
            return text.split('\n')
                .filter(l => l.trim())
                .map(l => {
                    const cols = l.split(/,|\t/).map(c => c.trim().replace(/^"|"$/g, ''));
                    const login = cols[0];
                    const firstName = cols[1] || '';
                    const lastName = cols[2] || '';
                    return { login, firstName, lastName };
                })
                .filter(o => o.login && !/login|name|รหัส/i.test(o.login));
        }

        function handleCompare() {
            const textA = document.getElementById('inputA').value;
            const textB = document.getElementById('inputB').value;
            if (!textA || !textB) { Swal.fire({ icon: 'warning', title: 'ข้อมูลไม่ครบ', text: 'กรุณาใส่ข้อมูลทั้งช่อง A และ B' }); return; }
            Swal.fire({ title: 'กำลังประมวลผล...', didOpen: () => Swal.showLoading() });
            setTimeout(() => {
                const dataA = parseForCompare(textA);
                const dataB = parseForCompare(textB);
                const mapA = new Map(dataA.map(i => [i.login.toLowerCase(), i]));
                const mapB = new Map(dataB.map(i => [i.login.toLowerCase(), i]));
                const missing = dataA.filter(i => !mapB.has(i.login.toLowerCase()));
                const newItems = dataB.filter(i => !mapA.has(i.login.toLowerCase()));
                compareData = { missing, newItems };
                
                renderCompareTable('tbodyMissing', missing, 'text-red-600');
                renderCompareTable('tbodyNew', newItems, 'text-emerald-600');
                
                document.getElementById('countMissing').textContent = missing.length;
                document.getElementById('countNew').textContent = newItems.length;
                document.getElementById('compareResults').classList.remove('hidden');
                document.getElementById('exportCompareBtn').classList.remove('hidden');
                Swal.fire({ icon: 'success', title: 'เปรียบเทียบเสร็จสิ้น', timer: 1000, showConfirmButton: false });
            }, 500);
        }

        function renderCompareTable(tbodyId, data, colorClass) {
            const tbody = document.getElementById(tbodyId);
            tbody.innerHTML = '';
            if (data.length === 0) {
                tbody.innerHTML = '<tr><td colspan="2" class="p-6 text-center text-slate-400 italic">ไม่พบข้อมูล</td></tr>';
                return;
            }
            data.forEach(item => {
                const fullName = `${item.firstName} ${item.lastName}`.trim();
                tbody.insertAdjacentHTML('beforeend', `
                    <tr class="transition-colors border-b border-slate-50 last:border-0">
                        <td class="p-4 font-mono font-bold ${colorClass}">${item.login}</td>
                        <td class="p-4 text-slate-600">${fullName}</td>
                    </tr>
                `);
            });
        }

        function exportComparison() {
            if (compareData.missing.length === 0 && compareData.newItems.length === 0) return;
            const wb = XLSX.utils.book_new();
            const wsMissing = XLSX.utils.json_to_sheet(compareData.missing.map(i => ({ 
                "Login": i.login, "Name": `${i.firstName} ${i.lastName}`.trim()
            })));
            XLSX.utils.book_append_sheet(wb, wsMissing, "หายไป (Missing)");
            const wsNew = XLSX.utils.json_to_sheet(compareData.newItems.map(i => ({ 
                "Login": i.login, "Name": `${i.firstName} ${i.lastName}`.trim()
            })));
            XLSX.utils.book_append_sheet(wb, wsNew, "มาใหม่ (New)");
            XLSX.writeFile(wb, `Comparison_Report_${new Date().getTime()}.xlsx`);
        }

        // ========================
        // UTILS
        // ========================
        function loadFileToTextarea(input, targetId) {
            const file = input.files[0];
            if (!file) return;
            const reader = new FileReader();
            if (file.name.match(/\.(xlsx|xls)$/)) {
                reader.onload = (e) => {
                    const data = new Uint8Array(e.target.result);
                    const wb = XLSX.read(data, {type: 'array'});
                    const ws = wb.Sheets[wb.SheetNames[0]];
                    const rows = XLSX.utils.sheet_to_json(ws, {header: 1});
                    document.getElementById(targetId).value = rows.map(r => r.join(',')).join('\n');
                };
                reader.readAsArrayBuffer(file);
            } else {
                reader.onload = (e) => document.getElementById(targetId).value = e.target.result;
                reader.readAsText(file);
            }
        }
        function confirmClearAll() {
            if (!document.getElementById('inputText').value && processedResults.length === 0) return;
            Swal.fire({
                title: 'ยืนยันล้างข้อมูล?', icon: 'warning', showCancelButton: true,
                confirmButtonColor: '#ef4444', confirmButtonText: 'ลบทั้งหมด', cancelButtonText: 'ยกเลิก'
            }).then((result) => {
                if (result.isConfirmed) {
                    document.getElementById('inputText').value = '';
                    document.getElementById('resultBody').innerHTML = '';
                    processedResults = [];
                    document.getElementById('tableContainer').classList.add('hidden');
                    document.getElementById('downloadBtn').classList.add('hidden');
                    document.getElementById('emptyState').classList.remove('hidden');
                }
            });
        }
        function downloadExcel() {
            if (processedResults.length === 0) return;
            const data = [
                ["Login name", "First name", "Last name", "Description", "Password", "Repeat password", "First Name of company / authority", "Group name"],
                ...processedResults.map(r => [r.loginName, r.firstName, r.lastName, r.description, r.password, r.password, r.company, r.groupName])
            ];
            const ws = XLSX.utils.aoa_to_sheet(data);
            const wb = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(wb, ws, "AOT_Import_Data");
            XLSX.writeFile(wb, `AOT_Import_${new Date().getTime()}.xlsx`);
        }
        document.getElementById('fileInput').addEventListener('change', function(e) { loadFileToTextarea(this, 'inputText'); });

        init();
    </script>
</body>
</html>
